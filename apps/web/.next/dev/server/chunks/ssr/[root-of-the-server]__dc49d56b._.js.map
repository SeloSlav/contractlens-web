{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/docs/%5BdocId%5D/chat/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { useParams } from \"next/navigation\";\n\nasync function sendMessage(\n  docId: string,\n  messages: { role: string; content: string }[]\n) {\n  const res = await fetch(\"/api/chat\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ docId, messages }),\n  });\n  if (!res.ok) {\n    const data = await res.json();\n    throw new Error(data.error ?? \"Chat failed\");\n  }\n  return res.json();\n}\n\nexport default function ChatPage() {\n  const params = useParams();\n  const docId = params?.docId as string | undefined;\n  const [messages, setMessages] = useState<{ role: string; content: string }[]>(\n    []\n  );\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [citations, setCitations] = useState<\n    { docId: string; chunkId: string; snippet: string }[]\n  >([]);\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    if (!docId || !input.trim() || loading) return;\n\n    const userMsg = { role: \"user\", content: input.trim() };\n    setMessages((m) => [...m, userMsg]);\n    setInput(\"\");\n    setLoading(true);\n\n    try {\n      const { answer, citations: cits } = await sendMessage(docId, [\n        ...messages,\n        userMsg,\n      ]);\n      setMessages((m) => [...m, { role: \"assistant\", content: answer }]);\n      setCitations(cits ?? []);\n    } catch (err) {\n      setMessages((m) => [\n        ...m,\n        {\n          role: \"assistant\",\n          content: `Error: ${err instanceof Error ? err.message : \"Unknown error\"}`,\n        },\n      ]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (!docId) return null;\n\n  return (\n    <div className=\"min-h-screen bg-zinc-50 dark:bg-black flex flex-col\">\n      <header className=\"border-b border-zinc-200 dark:border-zinc-800 p-4\">\n        <div className=\"max-w-3xl mx-auto flex items-center gap-4\">\n          <Link\n            href={`/docs/${docId}`}\n            className=\"text-zinc-600 dark:text-zinc-400 hover:underline\"\n          >\n            ‚Üê Back\n          </Link>\n          <h1 className=\"font-semibold\">Chat with Document</h1>\n        </div>\n      </header>\n\n      <main className=\"flex-1 overflow-y-auto p-4\">\n        <div className=\"max-w-3xl mx-auto space-y-4\">\n          {messages.length === 0 && (\n            <p className=\"text-zinc-500 dark:text-zinc-400 text-center py-12\">\n              Ask a question about this contract. Answers include citations.\n            </p>\n          )}\n          {messages.map((m, i) => (\n            <div\n              key={i}\n              className={`p-4 rounded-lg ${\n                m.role === \"user\"\n                  ? \"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 ml-8\"\n                  : \"bg-zinc-200 dark:bg-zinc-800 mr-8\"\n              }`}\n            >\n              <p className=\"whitespace-pre-wrap\">{m.content}</p>\n            </div>\n          ))}\n          {loading && (\n            <div className=\"flex gap-2 p-4 text-zinc-500\">\n              <span className=\"animate-pulse\">Thinking...</span>\n            </div>\n          )}\n          <div ref={bottomRef} />\n        </div>\n      </main>\n\n      {citations.length > 0 && (\n        <div className=\"border-t border-zinc-200 dark:border-zinc-800 p-4 bg-zinc-100 dark:bg-zinc-900/50\">\n          <div className=\"max-w-3xl mx-auto\">\n            <h3 className=\"text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2\">\n              Citations\n            </h3>\n            <div className=\"space-y-2 max-h-32 overflow-y-auto\">\n              {citations.map((c, i) => (\n                <div\n                  key={i}\n                  className=\"text-xs p-2 bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-700\"\n                >\n                  <span className=\"font-mono text-zinc-500\">{c.chunkId}</span>\n                  <p className=\"mt-1 text-zinc-600 dark:text-zinc-400 line-clamp-2\">\n                    {c.snippet}\n                  </p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <form onSubmit={handleSubmit} className=\"p-4 border-t border-zinc-200 dark:border-zinc-800\">\n        <div className=\"max-w-3xl mx-auto flex gap-2\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Ask about the contract...\"\n            className=\"flex-1 px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100\"\n            disabled={loading}\n          />\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg hover:opacity-90 disabled:opacity-50\"\n          >\n            Send\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,eAAe,YACb,KAAa,EACb,QAA6C;IAE7C,MAAM,MAAM,MAAM,MAAM,aAAa;QACnC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;YAAO;QAAS;IACzC;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;IAChC;IACA,OAAO,IAAI,IAAI;AACjB;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,QAAQ,QAAQ;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EACtC,EAAE;IAEJ,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAExC,EAAE;IACJ,MAAM,YAAY,IAAA,+MAAM,EAAiB;IAEzC,IAAA,kNAAS,EAAC;QACR,UAAU,OAAO,EAAE,eAAe;YAAE,UAAU;QAAS;IACzD,GAAG;QAAC;KAAS;IAEb,eAAe,aAAa,CAAkB;QAC5C,EAAE,cAAc;QAChB,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,MAAM,SAAS;QAExC,MAAM,UAAU;YAAE,MAAM;YAAQ,SAAS,MAAM,IAAI;QAAG;QACtD,YAAY,CAAC,IAAM;mBAAI;gBAAG;aAAQ;QAClC,SAAS;QACT,WAAW;QAEX,IAAI;YACF,MAAM,EAAE,MAAM,EAAE,WAAW,IAAI,EAAE,GAAG,MAAM,YAAY,OAAO;mBACxD;gBACH;aACD;YACD,YAAY,CAAC,IAAM;uBAAI;oBAAG;wBAAE,MAAM;wBAAa,SAAS;oBAAO;iBAAE;YACjE,aAAa,QAAQ,EAAE;QACzB,EAAE,OAAO,KAAK;YACZ,YAAY,CAAC,IAAM;uBACd;oBACH;wBACE,MAAM;wBACN,SAAS,CAAC,OAAO,EAAE,eAAe,QAAQ,IAAI,OAAO,GAAG,iBAAiB;oBAC3E;iBACD;QACH,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAI,CAAC,OAAO,OAAO;IAEnB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAO,WAAU;0BAChB,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC,uKAAI;4BACH,MAAM,CAAC,MAAM,EAAE,OAAO;4BACtB,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BAAG,WAAU;sCAAgB;;;;;;;;;;;;;;;;;0BAIlC,8OAAC;gBAAK,WAAU;0BACd,cAAA,8OAAC;oBAAI,WAAU;;wBACZ,SAAS,MAAM,KAAK,mBACnB,8OAAC;4BAAE,WAAU;sCAAqD;;;;;;wBAInE,SAAS,GAAG,CAAC,CAAC,GAAG,kBAChB,8OAAC;gCAEC,WAAW,CAAC,eAAe,EACzB,EAAE,IAAI,KAAK,SACP,oEACA,qCACJ;0CAEF,cAAA,8OAAC;oCAAE,WAAU;8CAAuB,EAAE,OAAO;;;;;;+BAPxC;;;;;wBAUR,yBACC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAK,WAAU;0CAAgB;;;;;;;;;;;sCAGpC,8OAAC;4BAAI,KAAK;;;;;;;;;;;;;;;;;YAIb,UAAU,MAAM,GAAG,mBAClB,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAA4D;;;;;;sCAG1E,8OAAC;4BAAI,WAAU;sCACZ,UAAU,GAAG,CAAC,CAAC,GAAG,kBACjB,8OAAC;oCAEC,WAAU;;sDAEV,8OAAC;4CAAK,WAAU;sDAA2B,EAAE,OAAO;;;;;;sDACpD,8OAAC;4CAAE,WAAU;sDACV,EAAE,OAAO;;;;;;;mCALP;;;;;;;;;;;;;;;;;;;;;0BAcjB,8OAAC;gBAAK,UAAU;gBAAc,WAAU;0BACtC,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4BACxC,aAAY;4BACZ,WAAU;4BACV,UAAU;;;;;;sCAEZ,8OAAC;4BACC,MAAK;4BACL,UAAU;4BACV,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;;AAOX"}}]
}