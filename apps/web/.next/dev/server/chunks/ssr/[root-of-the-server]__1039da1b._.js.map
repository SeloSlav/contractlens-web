{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/docs/%5BdocId%5D/DocActions.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport function DocActions({\n  docId,\n  status,\n}: {\n  docId: string;\n  status: string;\n}) {\n  const [ingesting, setIngesting] = useState(false);\n  const router = useRouter();\n\n  async function handleIngest() {\n    setIngesting(true);\n    try {\n      const res = await fetch(\"/api/ingest\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ docId }),\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        const msg = data.details ?? data.error ?? \"Ingest failed\";\n        throw new Error(msg);\n      }\n      router.refresh();\n    } catch (err) {\n      alert(err instanceof Error ? err.message : \"Ingest failed\");\n    } finally {\n      setIngesting(false);\n    }\n  }\n\n  return (\n    <div className=\"flex gap-4 mt-8 flex-wrap\">\n      {status === \"queued\" && (\n        <button\n          onClick={handleIngest}\n          disabled={ingesting}\n          className=\"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 disabled:opacity-50\"\n        >\n          {ingesting ? \"Ingesting...\" : \"Run Ingest\"}\n        </button>\n      )}\n      <Link\n        href={`/docs/${docId}/chat`}\n        className=\"px-4 py-2 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900 rounded-lg hover:opacity-90\"\n      >\n        Chat\n      </Link>\n      <Link\n        href={`/docs/${docId}/analyze`}\n        className=\"px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800\"\n      >\n        Analyze\n      </Link>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMO,SAAS,WAAW,EACzB,KAAK,EACL,MAAM,EAIP;IACC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,SAAS,IAAA,+IAAS;IAExB,eAAe;QACb,aAAa;QACb,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,eAAe;gBACrC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAM;YAC/B;YACA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;gBAC7C,MAAM,MAAM,KAAK,OAAO,IAAI,KAAK,KAAK,IAAI;gBAC1C,MAAM,IAAI,MAAM;YAClB;YACA,OAAO,OAAO;QAChB,EAAE,OAAO,KAAK;YACZ,MAAM,eAAe,QAAQ,IAAI,OAAO,GAAG;QAC7C,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;;YACZ,WAAW,0BACV,8OAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAU;0BAET,YAAY,iBAAiB;;;;;;0BAGlC,8OAAC,uKAAI;gBACH,MAAM,CAAC,MAAM,EAAE,MAAM,KAAK,CAAC;gBAC3B,WAAU;0BACX;;;;;;0BAGD,8OAAC,uKAAI;gBACH,MAAM,CAAC,MAAM,EAAE,MAAM,QAAQ,CAAC;gBAC9B,WAAU;0BACX;;;;;;;;;;;;AAKP"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/docs/%5BdocId%5D/FindingsTable.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\ntype Finding = {\n  risk_level: string;\n  category: string;\n  title: string;\n  description: string;\n  why_it_matters?: string;\n  suggested_questions?: string[];\n  suggested_redline?: string;\n  citations?: { docId: string; chunkId: string; snippet: string }[];\n  confidence?: number;\n};\n\nasync function submitFeedback(\n  runId: string,\n  findingId: string,\n  rating: 1 | -1,\n  note?: string\n) {\n  await fetch(\"/api/feedback\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ runId, findingId, rating, note }),\n  });\n}\n\ntype Run = {\n  _id: string;\n  type: string;\n  createdAt: string;\n  status: string;\n  outputs?: { findings?: Finding[] };\n};\n\nexport function FindingsTable({ docId }: { docId: string }) {\n  const [runs, setRuns] = useState<Run[]>([]);\n  const [selectedRunId, setSelectedRunId] = useState<string | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [feedbackSent, setFeedbackSent] = useState<Set<string>>(new Set());\n\n  useEffect(() => {\n    fetch(`/api/runs?docId=${docId}`)\n      .then((r) => r.json())\n      .then((d) => {\n        setRuns(d.runs ?? []);\n        const analysisRun = (d.runs ?? []).find(\n          (r: Run) => r.type === \"analysis\" && r.outputs?.findings\n        );\n        if (analysisRun) setSelectedRunId(analysisRun._id);\n      });\n  }, [docId]);\n\n  const selectedRun = runs.find((r) => r._id === selectedRunId);\n  const findings = selectedRun?.outputs?.findings ?? [];\n\n  if (runs.length === 0) return null;\n\n  return (\n    <div className=\"mt-8\">\n      <h2 className=\"text-lg font-medium text-zinc-900 dark:text-zinc-100 mb-4\">\n        Findings\n      </h2>\n      {findings.length === 0 ? (\n        <p className=\"text-zinc-500 dark:text-zinc-400 text-sm\">\n          No findings yet. Run analysis to generate findings.\n        </p>\n      ) : (\n        <div className=\"space-y-2\">\n          {findings.map((f, i) => {\n            const fid = `${selectedRunId}-${i}`;\n            const chunkId = f.citations?.[0]?.chunkId ?? fid;\n            const expanded = expandedId === fid;\n            return (\n              <div\n                key={fid}\n                className=\"border border-zinc-200 dark:border-zinc-700 rounded-lg overflow-hidden\"\n              >\n                <button\n                  onClick={() => setExpandedId(expanded ? null : fid)}\n                  className=\"w-full px-4 py-3 flex items-center gap-4 text-left hover:bg-zinc-50 dark:hover:bg-zinc-800/50\"\n                >\n                  <span\n                    className={`px-2 py-0.5 rounded text-xs font-medium ${\n                      f.risk_level === \"high\"\n                        ? \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                        : f.risk_level === \"medium\"\n                          ? \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\"\n                          : \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n                    }`}\n                  >\n                    {f.risk_level}\n                  </span>\n                  <span className=\"text-xs text-zinc-500\">{f.category}</span>\n                  <span className=\"flex-1 font-medium\">{f.title}</span>\n                  <span className=\"text-xs text-zinc-500\">\n                    {Math.round((f.confidence ?? 0) * 100)}%\n                  </span>\n                  <span className=\"text-zinc-400\">{expanded ? \"‚àí\" : \"+\"}</span>\n                </button>\n                {expanded && (\n                  <div className=\"px-4 pb-4 pt-0 border-t border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900/30\">\n                    <p className=\"text-sm text-zinc-600 dark:text-zinc-400 mt-2\">\n                      {f.description}\n                    </p>\n                    {f.why_it_matters && (\n                      <p className=\"text-sm text-zinc-600 dark:text-zinc-400 mt-2\">\n                        <strong>Why it matters:</strong> {f.why_it_matters}\n                      </p>\n                    )}\n                    {f.suggested_questions && f.suggested_questions.length > 0 && (\n                      <div className=\"mt-2\">\n                        <strong className=\"text-sm\">Suggested questions:</strong>\n                        <ul className=\"list-disc list-inside text-sm text-zinc-600 dark:text-zinc-400 mt-1\">\n                          {f.suggested_questions.map((q, j) => (\n                            <li key={j}>{q}</li>\n                          ))}\n                        </ul>\n                      </div>\n                    )}\n                    {f.suggested_redline && (\n                      <p className=\"text-sm text-zinc-600 dark:text-zinc-400 mt-2\">\n                        <strong>Suggested redline:</strong> {f.suggested_redline}\n                      </p>\n                    )}\n                    <div className=\"mt-3 flex gap-2\">\n                      <button\n                        onClick={() => {\n                          if (selectedRunId) {\n                            submitFeedback(selectedRunId, chunkId, 1);\n                            setFeedbackSent((s) => new Set(s).add(`${fid}-up`));\n                          }\n                        }}\n                        disabled={feedbackSent.has(`${fid}-up`)}\n                        className=\"px-2 py-1 text-sm border border-zinc-300 dark:border-zinc-600 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 disabled:opacity-50\"\n                      >\n                        üëç\n                      </button>\n                      <button\n                        onClick={() => {\n                          if (selectedRunId) {\n                            submitFeedback(selectedRunId, chunkId, -1);\n                            setFeedbackSent((s) => new Set(s).add(`${fid}-down`));\n                          }\n                        }}\n                        disabled={feedbackSent.has(`${fid}-down`)}\n                        className=\"px-2 py-1 text-sm border border-zinc-300 dark:border-zinc-600 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800 disabled:opacity-50\"\n                      >\n                        üëé\n                      </button>\n                    </div>\n                    {f.citations && f.citations.length > 0 && (\n                      <div className=\"mt-3\">\n                        <strong className=\"text-sm\">Evidence:</strong>\n                        <div className=\"mt-2 space-y-2\">\n                          {f.citations.map((c, j) => (\n                            <div\n                              key={j}\n                              className=\"p-2 bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-700 text-xs\"\n                            >\n                              <span className=\"font-mono text-zinc-500\">\n                                {c.chunkId}\n                              </span>\n                              <p className=\"mt-1 text-zinc-600 dark:text-zinc-400\">\n                                {c.snippet}\n                              </p>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 425, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/docs/%5BdocId%5D/RunHistory.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\n\ntype Run = {\n  _id: string;\n  type: string;\n  createdAt: string;\n  status: string;\n  durationMs?: number;\n};\n\nexport function RunHistory({ docId }: { docId: string }) {\n  const [runs, setRuns] = useState<Run[]>([]);\n\n  useEffect(() => {\n    fetch(`/api/runs?docId=${docId}`)\n      .then((r) => r.json())\n      .then((d) => setRuns(d.runs ?? []));\n  }, [docId]);\n\n  if (runs.length === 0) return null;\n\n  return (\n    <div className=\"mt-8\">\n      <h2 className=\"text-lg font-medium text-zinc-900 dark:text-zinc-100 mb-4\">\n        Run History\n      </h2>\n      <div className=\"space-y-2\">\n        {runs.map((r) => (\n          <div\n            key={r._id}\n            className=\"flex items-center gap-4 p-3 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm\"\n          >\n            <span className=\"text-zinc-500\">{r.type}</span>\n            <span className=\"text-zinc-500\">\n              {new Date(r.createdAt).toLocaleString()}\n            </span>\n            <span\n              className={`px-2 py-0.5 rounded text-xs ${\n                r.status === \"completed\" || r.status === \"ready\"\n                  ? \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\"\n                  : r.status === \"failed\"\n                    ? \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\"\n                    : \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\"\n              }`}\n            >\n              {r.status}\n            </span>\n            {r.durationMs != null && (\n              <span className=\"text-zinc-500\">{r.durationMs}ms</span>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAaO,SAAS,WAAW,EAAE,KAAK,EAAqB;IACrD,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAE1C,IAAA,kNAAS,EAAC;QACR,MAAM,CAAC,gBAAgB,EAAE,OAAO,EAC7B,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,IAClB,IAAI,CAAC,CAAC,IAAM,QAAQ,EAAE,IAAI,IAAI,EAAE;IACrC,GAAG;QAAC;KAAM;IAEV,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;IAE9B,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAA4D;;;;;;0BAG1E,8OAAC;gBAAI,WAAU;0BACZ,KAAK,GAAG,CAAC,CAAC,kBACT,8OAAC;wBAEC,WAAU;;0CAEV,8OAAC;gCAAK,WAAU;0CAAiB,EAAE,IAAI;;;;;;0CACvC,8OAAC;gCAAK,WAAU;0CACb,IAAI,KAAK,EAAE,SAAS,EAAE,cAAc;;;;;;0CAEvC,8OAAC;gCACC,WAAW,CAAC,4BAA4B,EACtC,EAAE,MAAM,KAAK,eAAe,EAAE,MAAM,KAAK,UACrC,yEACA,EAAE,MAAM,KAAK,WACX,iEACA,4EACN;0CAED,EAAE,MAAM;;;;;;4BAEV,EAAE,UAAU,IAAI,sBACf,8OAAC;gCAAK,WAAU;;oCAAiB,EAAE,UAAU;oCAAC;;;;;;;;uBAnB3C,EAAE,GAAG;;;;;;;;;;;;;;;;AA0BtB"}}]
}