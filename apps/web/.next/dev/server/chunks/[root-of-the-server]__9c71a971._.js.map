{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI ?? \"mongodb://localhost:27017/contractlens\";\n\nlet client: MongoClient | null = null;\nlet clientPromise: Promise<MongoClient> | null = null;\n\nfunction getClient(): Promise<MongoClient> {\n  if (clientPromise) return clientPromise;\n  clientPromise = new MongoClient(uri).connect();\n  return clientPromise;\n}\n\nexport async function getDb(): Promise<Db> {\n  const c = await getClient();\n  return c.db();\n}\n\nexport async function ensureIndexes(): Promise<void> {\n  const db = await getDb();\n  await db.collection(\"documents\").createIndex({ createdAt: -1 });\n  await db.collection(\"chunks\").createIndex({ docId: 1 });\n  await db.collection(\"runs\").createIndex({ docId: 1 });\n  await db.collection(\"feedback\").createIndex({ runId: 1 });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI;AAEvC,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAEjD,SAAS;IACP,IAAI,eAAe,OAAO;IAC1B,gBAAgB,IAAI,oKAAW,CAAC,KAAK,OAAO;IAC5C,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,IAAI,MAAM;IAChB,OAAO,EAAE,EAAE;AACb;AAEO,eAAe;IACpB,MAAM,KAAK,MAAM;IACjB,MAAM,GAAG,UAAU,CAAC,aAAa,WAAW,CAAC;QAAE,WAAW,CAAC;IAAE;IAC7D,MAAM,GAAG,UAAU,CAAC,UAAU,WAAW,CAAC;QAAE,OAAO;IAAE;IACrD,MAAM,GAAG,UAAU,CAAC,QAAQ,WAAW,CAAC;QAAE,OAAO;IAAE;IACnD,MAAM,GAAG,UAAU,CAAC,YAAY,WAAW,CAAC;QAAE,OAAO;IAAE;AACzD"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/schemas/document.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const DocumentStatusSchema = z.enum([\n  \"queued\",\n  \"processing\",\n  \"ready\",\n  \"failed\",\n]);\n\nexport const SourceTypeSchema = z.enum([\"pdf\", \"text\", \"url\"]);\n\nexport const DocumentStatsSchema = z.object({\n  numChunks: z.number().optional(),\n  numTokensApprox: z.number().optional(),\n  ingestMs: z.number().optional(),\n});\n\nexport const DocumentCreateSchema = z.object({\n  sourceType: SourceTypeSchema,\n  content: z.string().optional(),\n  url: z.string().url().optional(),\n  title: z.string().optional(),\n});\n\nexport const DocumentRecordSchema = z.object({\n  _id: z.string(),\n  title: z.string().optional(),\n  sourceType: SourceTypeSchema,\n  sourceUrl: z.string().optional(),\n  createdAt: z.date(),\n  status: DocumentStatusSchema,\n  stats: DocumentStatsSchema.optional(),\n});\n\nexport type DocumentStatus = z.infer<typeof DocumentStatusSchema>;\nexport type SourceType = z.infer<typeof SourceTypeSchema>;\nexport type DocumentStats = z.infer<typeof DocumentStatsSchema>;\nexport type DocumentCreate = z.infer<typeof DocumentCreateSchema>;\nexport type DocumentRecord = z.infer<typeof DocumentRecordSchema>;\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEO,MAAM,uBAAuB,yKAAC,CAAC,IAAI,CAAC;IACzC;IACA;IACA;IACA;CACD;AAEM,MAAM,mBAAmB,yKAAC,CAAC,IAAI,CAAC;IAAC;IAAO;IAAQ;CAAM;AAEtD,MAAM,sBAAsB,yKAAC,CAAC,MAAM,CAAC;IAC1C,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,iBAAiB,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACpC,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC/B;AAEO,MAAM,uBAAuB,yKAAC,CAAC,MAAM,CAAC;IAC3C,YAAY;IACZ,SAAS,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,KAAK,yKAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ;IAC9B,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAEO,MAAM,uBAAuB,yKAAC,CAAC,MAAM,CAAC;IAC3C,KAAK,yKAAC,CAAC,MAAM;IACb,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,YAAY;IACZ,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,WAAW,yKAAC,CAAC,IAAI;IACjB,QAAQ;IACR,OAAO,oBAAoB,QAAQ;AACrC"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/schemas/chunk.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const ChunkMetadataSchema = z.object({\n  page: z.number().optional(),\n  section: z.string().optional(),\n  sourceUrl: z.string().optional(),\n});\n\nexport const ChunkRecordSchema = z.object({\n  _id: z.string(),\n  docId: z.string(),\n  chunkIndex: z.number(),\n  chromaId: z.string(),\n  text: z.string(),\n  textPreview: z.string().optional(),\n  tokenApprox: z.number().optional(),\n  metadata: ChunkMetadataSchema.optional(),\n});\n\nexport type ChunkMetadata = z.infer<typeof ChunkMetadataSchema>;\nexport type ChunkRecord = z.infer<typeof ChunkRecordSchema>;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,sBAAsB,yKAAC,CAAC,MAAM,CAAC;IAC1C,MAAM,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACzB,SAAS,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAChC;AAEO,MAAM,oBAAoB,yKAAC,CAAC,MAAM,CAAC;IACxC,KAAK,yKAAC,CAAC,MAAM;IACb,OAAO,yKAAC,CAAC,MAAM;IACf,YAAY,yKAAC,CAAC,MAAM;IACpB,UAAU,yKAAC,CAAC,MAAM;IAClB,MAAM,yKAAC,CAAC,MAAM;IACd,aAAa,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,aAAa,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,UAAU,oBAAoB,QAAQ;AACxC"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/schemas/finding.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const RiskLevelSchema = z.enum([\"low\", \"medium\", \"high\"]);\n\nexport const FindingCategorySchema = z.enum([\n  \"termination\",\n  \"liability\",\n  \"indemnity\",\n  \"privacy\",\n  \"payment\",\n  \"renewal\",\n  \"jurisdiction\",\n  \"IP\",\n  \"confidentiality\",\n  \"warranty\",\n  \"limitation_of_liability\",\n  \"assignment\",\n  \"dispute_resolution\",\n  \"SLA\",\n]);\n\nexport const CitationSchema = z.object({\n  docId: z.string(),\n  chunkId: z.string(),\n  snippet: z.string(),\n  startOffset: z.number().optional(),\n  endOffset: z.number().optional(),\n});\n\nexport const FindingSchema = z.object({\n  risk_level: RiskLevelSchema,\n  category: FindingCategorySchema,\n  title: z.string(),\n  description: z.string(),\n  why_it_matters: z.string(),\n  suggested_questions: z.array(z.string()),\n  suggested_redline: z.string().optional(),\n  citations: z.array(CitationSchema),\n  confidence: z.number().min(0).max(1),\n});\n\nexport type RiskLevel = z.infer<typeof RiskLevelSchema>;\nexport type FindingCategory = z.infer<typeof FindingCategorySchema>;\nexport type Citation = z.infer<typeof CitationSchema>;\nexport type Finding = z.infer<typeof FindingSchema>;\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEO,MAAM,kBAAkB,yKAAC,CAAC,IAAI,CAAC;IAAC;IAAO;IAAU;CAAO;AAExD,MAAM,wBAAwB,yKAAC,CAAC,IAAI,CAAC;IAC1C;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,iBAAiB,yKAAC,CAAC,MAAM,CAAC;IACrC,OAAO,yKAAC,CAAC,MAAM;IACf,SAAS,yKAAC,CAAC,MAAM;IACjB,SAAS,yKAAC,CAAC,MAAM;IACjB,aAAa,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAChC;AAEO,MAAM,gBAAgB,yKAAC,CAAC,MAAM,CAAC;IACpC,YAAY;IACZ,UAAU;IACV,OAAO,yKAAC,CAAC,MAAM;IACf,aAAa,yKAAC,CAAC,MAAM;IACrB,gBAAgB,yKAAC,CAAC,MAAM;IACxB,qBAAqB,yKAAC,CAAC,KAAK,CAAC,yKAAC,CAAC,MAAM;IACrC,mBAAmB,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACtC,WAAW,yKAAC,CAAC,KAAK,CAAC;IACnB,YAAY,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;AACpC"}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/schemas/run.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const RunTypeSchema = z.enum([\"analysis\", \"chat\"]);\n\nexport const TokenUsageSchema = z.object({\n  prompt: z.number().optional(),\n  completion: z.number().optional(),\n  total: z.number().optional(),\n});\n\nexport const RunRecordSchema = z.object({\n  _id: z.string(),\n  docId: z.string(),\n  type: RunTypeSchema,\n  createdAt: z.date(),\n  provider: z.string().optional(),\n  model: z.string().optional(),\n  durationMs: z.number().optional(),\n  tokenUsage: TokenUsageSchema.optional(),\n  costUsdApprox: z.number().optional(),\n  inputs: z.record(z.unknown()).optional(),\n  outputs: z.record(z.unknown()).optional(),\n  events: z.array(z.unknown()).optional(),\n});\n\nexport type RunType = z.infer<typeof RunTypeSchema>;\nexport type TokenUsage = z.infer<typeof TokenUsageSchema>;\nexport type RunRecord = z.infer<typeof RunRecordSchema>;\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,MAAM,gBAAgB,yKAAC,CAAC,IAAI,CAAC;IAAC;IAAY;CAAO;AAEjD,MAAM,mBAAmB,yKAAC,CAAC,MAAM,CAAC;IACvC,QAAQ,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC3B,YAAY,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAEO,MAAM,kBAAkB,yKAAC,CAAC,MAAM,CAAC;IACtC,KAAK,yKAAC,CAAC,MAAM;IACb,OAAO,yKAAC,CAAC,MAAM;IACf,MAAM;IACN,WAAW,yKAAC,CAAC,IAAI;IACjB,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,YAAY,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,YAAY,iBAAiB,QAAQ;IACrC,eAAe,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAClC,QAAQ,yKAAC,CAAC,MAAM,CAAC,yKAAC,CAAC,OAAO,IAAI,QAAQ;IACtC,SAAS,yKAAC,CAAC,MAAM,CAAC,yKAAC,CAAC,OAAO,IAAI,QAAQ;IACvC,QAAQ,yKAAC,CAAC,KAAK,CAAC,yKAAC,CAAC,OAAO,IAAI,QAAQ;AACvC"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/schemas/feedback.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const FeedbackRecordSchema = z.object({\n  _id: z.string(),\n  runId: z.string(),\n  findingId: z.string().optional(),\n  rating: z.union([z.literal(1), z.literal(-1)]),\n  note: z.string().optional(),\n  createdAt: z.date(),\n});\n\nexport const FeedbackCreateSchema = z.object({\n  runId: z.string(),\n  findingId: z.string().optional(),\n  rating: z.union([z.literal(1), z.literal(-1)]),\n  note: z.string().optional(),\n});\n\nexport type FeedbackRecord = z.infer<typeof FeedbackRecordSchema>;\nexport type FeedbackCreate = z.infer<typeof FeedbackCreateSchema>;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,uBAAuB,yKAAC,CAAC,MAAM,CAAC;IAC3C,KAAK,yKAAC,CAAC,MAAM;IACb,OAAO,yKAAC,CAAC,MAAM;IACf,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,QAAQ,yKAAC,CAAC,KAAK,CAAC;QAAC,yKAAC,CAAC,OAAO,CAAC;QAAI,yKAAC,CAAC,OAAO,CAAC,CAAC;KAAG;IAC7C,MAAM,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACzB,WAAW,yKAAC,CAAC,IAAI;AACnB;AAEO,MAAM,uBAAuB,yKAAC,CAAC,MAAM,CAAC;IAC3C,OAAO,yKAAC,CAAC,MAAM;IACf,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,QAAQ,yKAAC,CAAC,KAAK,CAAC;QAAC,yKAAC,CAAC,OAAO,CAAC;QAAI,yKAAC,CAAC,OAAO,CAAC,CAAC;KAAG;IAC7C,MAAM,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC3B"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/packages/shared/src/index.ts"],"sourcesContent":["export * from \"./schemas/document\";\nexport * from \"./schemas/chunk\";\nexport * from \"./schemas/finding\";\nexport * from \"./schemas/run\";\nexport * from \"./schemas/feedback\";\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 300, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/api/docs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { ObjectId } from \"mongodb\";\nimport { getDb } from \"@/lib/mongodb\";\nimport {\n  DocumentCreateSchema,\n  type DocumentRecord,\n} from \"@contractlens/shared\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const parsed = DocumentCreateSchema.safeParse(body);\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid request\", details: parsed.error.flatten() },\n        { status: 400 }\n      );\n    }\n\n    const { sourceType, content, url, title } = parsed.data;\n\n    if (sourceType === \"text\" && !content) {\n      return NextResponse.json(\n        { error: \"content is required for text source\" },\n        { status: 400 }\n      );\n    }\n    if (sourceType === \"url\" && !url) {\n      return NextResponse.json(\n        { error: \"url is required for url source\" },\n        { status: 400 }\n      );\n    }\n    if (sourceType === \"pdf\" && !content) {\n      return NextResponse.json(\n        { error: \"content (base64) is required for pdf source\" },\n        { status: 400 }\n      );\n    }\n\n    const db = await getDb();\n    const doc = {\n      _id: new ObjectId(),\n      title: title ?? \"Untitled\",\n      sourceType,\n      sourceUrl: sourceType === \"url\" ? url : undefined,\n      content: sourceType !== \"url\" ? content : undefined,\n      createdAt: new Date(),\n      status: \"queued\" as const,\n    };\n\n    await db.collection(\"documents\").insertOne(doc);\n\n    return NextResponse.json({ docId: doc._id.toString() });\n  } catch (err) {\n    console.error(\"POST /api/docs error:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET() {\n  try {\n    const db = await getDb();\n    const cursor = db\n      .collection(\"documents\")\n      .find({})\n      .sort({ createdAt: -1 })\n      .limit(100);\n\n    const docs: DocumentRecord[] = [];\n    for await (const d of cursor) {\n      docs.push({\n        _id: d._id.toString(),\n        title: d.title,\n        sourceType: d.sourceType,\n        sourceUrl: d.sourceUrl,\n        createdAt: d.createdAt,\n        status: d.status,\n        stats: d.stats,\n      });\n    }\n\n    return NextResponse.json({ docs });\n  } catch (err) {\n    console.error(\"GET /api/docs error:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;AAKO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,0KAAoB,CAAC,SAAS,CAAC;QAC9C,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAmB,SAAS,OAAO,KAAK,CAAC,OAAO;YAAG,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,OAAO,IAAI;QAEvD,IAAI,eAAe,UAAU,CAAC,SAAS;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsC,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QACA,IAAI,eAAe,SAAS,CAAC,KAAK;YAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QACA,IAAI,eAAe,SAAS,CAAC,SAAS;YACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8C,GACvD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,KAAK,MAAM,IAAA,wIAAK;QACtB,MAAM,MAAM;YACV,KAAK,IAAI,iKAAQ;YACjB,OAAO,SAAS;YAChB;YACA,WAAW,eAAe,QAAQ,MAAM;YACxC,SAAS,eAAe,QAAQ,UAAU;YAC1C,WAAW,IAAI;YACf,QAAQ;QACV;QAEA,MAAM,GAAG,UAAU,CAAC,aAAa,SAAS,CAAC;QAE3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,GAAG,CAAC,QAAQ;QAAG;IACvD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,wIAAK;QACtB,MAAM,SAAS,GACZ,UAAU,CAAC,aACX,IAAI,CAAC,CAAC,GACN,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,KAAK,CAAC;QAET,MAAM,OAAyB,EAAE;QACjC,WAAW,MAAM,KAAK,OAAQ;YAC5B,KAAK,IAAI,CAAC;gBACR,KAAK,EAAE,GAAG,CAAC,QAAQ;gBACnB,OAAO,EAAE,KAAK;gBACd,YAAY,EAAE,UAAU;gBACxB,WAAW,EAAE,SAAS;gBACtB,WAAW,EAAE,SAAS;gBACtB,QAAQ,EAAE,MAAM;gBAChB,OAAO,EAAE,KAAK;YAChB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK;IAClC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}