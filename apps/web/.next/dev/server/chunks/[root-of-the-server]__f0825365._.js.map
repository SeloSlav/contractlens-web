{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/WebProjects/contractlens-web/apps/web/app/api/ingest/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nconst IngestBodySchema = z.object({ docId: z.string().min(1) });\n\nconst WORKER_URL = process.env.WORKER_URL ?? \"http://localhost:8001\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const parsed = IngestBodySchema.safeParse(body);\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"docId is required\" },\n        { status: 400 }\n      );\n    }\n\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 120000); // 2 min\n    const res = await fetch(`${WORKER_URL}/ingest`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ docId: parsed.data.docId }),\n      signal: controller.signal,\n    });\n    clearTimeout(timeout);\n\n    if (!res.ok) {\n      const err = await res.text();\n      console.error(\"Worker ingest error:\", err);\n      return NextResponse.json(\n        { error: \"Ingest failed\", details: err },\n        { status: 502 }\n      );\n    }\n\n    const data = await res.json();\n    return NextResponse.json({ accepted: true, ...data });\n  } catch (err) {\n    if (err instanceof Error && err.name === \"AbortError\") {\n      return NextResponse.json(\n        { error: \"Ingest timed out (120s)\" },\n        { status: 504 }\n      );\n    }\n    console.error(\"POST /api/ingest error:\", err);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,yKAAC,CAAC,MAAM,CAAC;IAAE,OAAO,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAAG;AAE7D,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,iBAAiB,SAAS,CAAC;QAC1C,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,IAAI;QACvB,MAAM,UAAU,WAAW,IAAM,WAAW,KAAK,IAAI,SAAS,QAAQ;QACtE,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,OAAO,CAAC,EAAE;YAC9C,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,OAAO,OAAO,IAAI,CAAC,KAAK;YAAC;YAChD,QAAQ,WAAW,MAAM;QAC3B;QACA,aAAa;QAEb,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAiB,SAAS;YAAI,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,UAAU;YAAM,GAAG,IAAI;QAAC;IACrD,EAAE,OAAO,KAAK;QACZ,IAAI,eAAe,SAAS,IAAI,IAAI,KAAK,cAAc;YACrD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QACA,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}