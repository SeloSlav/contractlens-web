module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},2157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},66486,(e,t,r)=>{t.exports=e.x("mongodb-438b504308ffa4be",()=>require("mongodb-438b504308ffa4be"))},67109,e=>{"use strict";var t=e.i(66486);let r=process.env.MONGODB_URI??"mongodb://localhost:27017/contractlens",n=null;async function o(){return(await (n||(n=new t.MongoClient(r).connect()))).db()}e.s(["getDb",()=>o])},2632,e=>{"use strict";e.s(["VERSION",0,"4.104.0"])},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},77538,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let n=new WeakMap,o=new WeakMap;function a(e){let t=n.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function s(e){if(null!=e.passiveListener){"u">typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener);return}e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault())}function i(e,t){n.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let r=Object.keys(t);for(let e=0;e<r.length;++e){let t=r[e];t in this||Object.defineProperty(this,t,l(t))}}function l(e){return{get(){return a(this).event[e]},set(t){a(this).event[e]=t},configurable:!0,enumerable:!0}}function u(e,t){a(e).passiveListener=t}i.prototype={get type(){return a(this).event.type},get target(){return a(this).eventTarget},get currentTarget(){return a(this).currentTarget},composedPath(){let e=a(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return a(this).eventPhase},stopPropagation(){let e=a(this);e.stopped=!0,"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){let e=a(this);e.stopped=!0,e.immediateStopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return!!a(this).event.bubbles},get cancelable(){return!!a(this).event.cancelable},preventDefault(){s(a(this))},get defaultPrevented(){return a(this).canceled},get composed(){return!!a(this).event.composed},get timeStamp(){return a(this).timeStamp},get srcElement(){return a(this).eventTarget},get cancelBubble(){return a(this).stopped},set cancelBubble(value){if(!value)return;let e=a(this);e.stopped=!0,"boolean"==typeof e.event.cancelBubble&&(e.event.cancelBubble=!0)},get returnValue(){return!a(this).canceled},set returnValue(value){value||s(a(this))},initEvent(){}},Object.defineProperty(i.prototype,"constructor",{value:i,configurable:!0,writable:!0});let p=new WeakMap;function c(e){return null!==e&&"object"==typeof e}function d(e){let t=p.get(e);if(null==t)throw TypeError("'this' is expected an EventTarget object, but got another value.");return t}function f(e,t){Object.defineProperty(e,`on${t}`,{get(){let e=d(this).get(t);for(;null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set(e){"function"==typeof e||c(e)||(e=null);let r=d(this),n=null,o=r.get(t);for(;null!=o;)3===o.listenerType?null!==n?n.next=o.next:null!==o.next?r.set(t,o.next):r.delete(t):n=o,o=o.next;if(null!==e){let o={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===n?r.set(t,o):n.next=o}},configurable:!0,enumerable:!0})}function h(e){function t(){g.call(this)}t.prototype=Object.create(g.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let r=0;r<e.length;++r)f(t.prototype,e[r]);return t}function g(){if(this instanceof g)return void p.set(this,new Map);if(1==arguments.length&&Array.isArray(arguments[0]))return h(arguments[0]);if(arguments.length>0){let e=Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return h(e)}throw TypeError("Cannot call a class as a function")}g.prototype={addEventListener(e,t,r){if(null==t)return;if("function"!=typeof t&&!c(t))throw TypeError("'listener' should be a function or an object.");let n=d(this),o=c(r),a=(o?r.capture:r)?1:2,s={listener:t,listenerType:a,passive:o&&!!r.passive,once:o&&!!r.once,next:null},i=n.get(e);if(void 0===i)return void n.set(e,s);let l=null;for(;null!=i;){if(i.listener===t&&i.listenerType===a)return;l=i,i=i.next}l.next=s},removeEventListener(e,t,r){if(null==t)return;let n=d(this),o=(c(r)?r.capture:r)?1:2,a=null,s=n.get(e);for(;null!=s;){if(s.listener===t&&s.listenerType===o)return void(null!==a?a.next=s.next:null!==s.next?n.set(e,s.next):n.delete(e));a=s,s=s.next}},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw TypeError('"event.type" should be a string.');let t=d(this),r=e.type,n=t.get(r);if(null==n)return!0;let s=new(function e(t){if(null==t||t===Object.prototype)return i;let r=o.get(t);return null==r&&(r=function(e,t){let r=Object.keys(t);if(0===r.length)return e;function n(t,r){e.call(this,t,r)}n.prototype=Object.create(e.prototype,{constructor:{value:n,configurable:!0,writable:!0}});for(let o=0;o<r.length;++o){let s=r[o];if(!(s in e.prototype)){let e="function"==typeof Object.getOwnPropertyDescriptor(t,s).value;Object.defineProperty(n.prototype,s,e?function(e){return{value(){let t=a(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}(s):l(s))}}return n}(e(Object.getPrototypeOf(t)),t),o.set(t,r)),r}(Object.getPrototypeOf(e)))(this,e),p=null;for(;null!=n;){if(n.once?null!==p?p.next=n.next:null!==n.next?t.set(r,n.next):t.delete(r):p=n,u(s,n.passive?n.listener:null),"function"==typeof n.listener)try{n.listener.call(this,s)}catch(e){"u">typeof console&&"function"==typeof console.error&&console.error(e)}else 3!==n.listenerType&&"function"==typeof n.listener.handleEvent&&n.listener.handleEvent(s);if(a(s).immediateStopped)break;n=n.next}return u(s,null),a(s).eventPhase=0,a(s).currentTarget=null,!s.defaultPrevented}},Object.defineProperty(g.prototype,"constructor",{value:g,configurable:!0,writable:!0}),r.defineEventAttribute=f,r.EventTarget=g,r.default=g,t.exports=g,t.exports.EventTarget=t.exports.default=g,t.exports.defineEventAttribute=f},37282,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e.r(77538);class AbortSignal extends n.EventTarget{constructor(){throw super(),TypeError("AbortSignal cannot be constructed directly")}get aborted(){let e=o.get(this);if("boolean"!=typeof e)throw TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return e}}n.defineEventAttribute(AbortSignal.prototype,"abort");let o=new WeakMap;Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class a{constructor(){s.set(this,function(){let e=Object.create(AbortSignal.prototype);return n.EventTarget.call(e),o.set(e,!1),e}())}get signal(){return i(this)}abort(){var e;e=i(this),!1===o.get(e)&&(o.set(e,!0),e.dispatchEvent({type:"abort"}))}}let s=new WeakMap;function i(e){let t=s.get(e);if(null==t)throw TypeError(`Expected 'this' to be an 'AbortController' object, but got ${null===e?"null":typeof e}`);return t}Object.defineProperties(a.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(a.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),r.AbortController=a,r.AbortSignal=AbortSignal,r.default=a,t.exports=a,t.exports.AbortController=t.exports.default=a,t.exports.AbortSignal=AbortSignal},65594,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),o=e.i(59756),a=e.i(61916),s=e.i(74677),i=e.i(69741),l=e.i(22372),u=e.i(87718),p=e.i(95169),c=e.i(47587),d=e.i(66012),f=e.i(70101),h=e.i(26937),g=e.i(10372),b=e.i(93695);e.i(52474);var v=e.i(220),y=e.i(89171),m=e.i(22632),x=e.i(89228),w=e.i(67109),E=e.i(6298);let R=m.z.object({docId:m.z.string().min(1),messages:m.z.array(m.z.object({role:m.z.enum(["user","assistant","system"]),content:m.z.string()}))}),P=`You are a contract analysis assistant. Answer ONLY based on the provided context from the document.
If the answer is not found in the context, say "Not found in the provided document."
Always cite your sources by referencing the chunk ID (e.g., [chunk: docId:0]) when making claims.
Be concise and professional. Do not provide legal advice.`;async function A(e){try{let t=await e.json(),r=R.safeParse(t);if(!r.success)return y.NextResponse.json({error:"Invalid request",details:r.error.flatten()},{status:400});let{docId:n,messages:o}=r.data,a=o.filter(e=>"user"===e.role).pop();if(!a)return y.NextResponse.json({error:"At least one user message required"},{status:400});let s=await (0,E.queryByDocId)(n,a.content,8),i=s.map(e=>`[${e.id}]: ${e.text}`).join("\n\n"),l=new x.default({apiKey:process.env.OPENAI_API_KEY}),u=await l.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:P},{role:"system",content:`Context from document:

${i||"(No relevant chunks found)"}`},...o]}),p=u.choices[0],c=p?.message?.content??"No response generated.",d=u.usage,f=s.map(e=>({docId:n,chunkId:e.id,snippet:e.text.slice(0,200)+(e.text.length>200?"...":"")})),h=await (0,w.getDb)();return await h.collection("runs").insertOne({docId:n,type:"chat",createdAt:new Date,provider:"openai",model:"gpt-4o-mini",tokenUsage:d?{prompt:d.prompt_tokens,completion:d.completion_tokens,total:d.total_tokens}:void 0,inputs:{docId:n,messageCount:o.length},outputs:{answer:c,citationCount:f.length}}),y.NextResponse.json({answer:c,citations:f,usage:d?{prompt:d.prompt_tokens,completion:d.completion_tokens,total:d.total_tokens}:void 0})}catch(e){return console.error("POST /api/chat error:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>A],46037);var T=e.i(46037);let j=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/apps/web/app/api/chat/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:_,workUnitAsyncStorage:O,serverHooks:S}=j;function k(){return(0,n.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:O})}async function C(e,t,n){j.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/chat/route";y=y.replace(/\/index$/,"")||"/";let m=await j.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!m)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:x,params:w,nextConfig:E,parsedUrl:R,isDraftMode:P,prerenderManifest:A,routerServerContext:T,isOnDemandRevalidate:_,revalidateOnlyGenerated:O,resolvedPathname:S,clientReferenceManifest:k,serverActionsManifest:C}=m,N=(0,i.normalizeAppPath)(y),I=!!(A.dynamicRoutes[N]||A.routes[S]),q=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,R,!1):t.end("This page could not be found"),null);if(I&&!P){let e=!!A.routes[S],t=A.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await q();throw new b.NoFallbackError}}let D=null;!I||j.isDev||P||(D="/index"===(D=S)?"/":D);let M=!0===j.isDev||!I,U=I&&!M;C&&k&&(0,s.setManifestsSingleton)({page:y,clientReferenceManifest:k,serverActionsManifest:C});let H=e.method||"GET",B=(0,a.getTracer)(),$=B.getActiveScopeSpan(),L={params:w,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,o)=>j.onRequestError(e,t,n,o,T)},sharedContext:{buildId:x}},K=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let s=async e=>j.handle(z,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${y}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&_&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=L.renderOpts.collectedTags;if(!I)return await (0,d.sendResponse)(K,F,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await j.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})},!1,T),t}},p=await j.handleResponse({req:e,nextConfig:E,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:i});if(!I)return null;if((null==p||null==(a=p.value)?void 0:a.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",_?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let b=(0,f.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&I||b.delete(g.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||b.get("Cache-Control")||b.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,d.sendResponse)(K,F,new Response(p.value.body,{headers:b,status:p.value.status||200})),null};$?await l($):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${y}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof b.NoFallbackError||await j.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})},!1,T),I)throw t;return await (0,d.sendResponse)(K,F,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>k,"routeModule",()=>j,"serverHooks",()=>S,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>O],65594)},19124,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__826cbbc8._.js"].map(t=>e.l(t))).then(()=>t(18870)))},82694,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_openai_index_mjs_56c03a84._.js"].map(t=>e.l(t))).then(()=>t(54124)))},78651,e=>{e.v(e=>Promise.resolve().then(()=>e(2632)))},56643,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@smithy_896c55f7._.js","server/chunks/node_modules_@smithy_39d03167._.js","server/chunks/[root-of-the-server]__4669b186._.js","server/chunks/[root-of-the-server]__298b84d2._.js"].map(t=>e.l(t))).then(()=>t(7127)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1c41d48b._.js.map