{"version":3,"sources":["../../../../../apps/web/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, Db } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI ?? \"mongodb://localhost:27017/contractlens\";\n\nlet client: MongoClient | null = null;\nlet clientPromise: Promise<MongoClient> | null = null;\n\nfunction getClient(): Promise<MongoClient> {\n  if (clientPromise) return clientPromise;\n  clientPromise = new MongoClient(uri).connect();\n  return clientPromise;\n}\n\nexport async function getDb(): Promise<Db> {\n  const c = await getClient();\n  return c.db();\n}\n\nexport async function ensureIndexes(): Promise<void> {\n  const db = await getDb();\n  await db.collection(\"documents\").createIndex({ createdAt: -1 });\n  await db.collection(\"chunks\").createIndex({ docId: 1 });\n  await db.collection(\"runs\").createIndex({ docId: 1 });\n  await db.collection(\"feedback\").createIndex({ runId: 1 });\n}\n"],"names":[],"mappings":"0IAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAM,QAAQ,GAAG,CAAC,WAAW,EAAI,yCAGnC,EAA6C,KAQ1C,eAAe,IAEpB,MADU,AACH,MADS,EANhB,AAAI,IACJ,EAAgB,IAAI,EAAA,GADD,OAAO,CACK,CAAC,GAAK,OAAO,EAAA,CADlB,CAMV,EACP,EAAE,EACb,CAEO,eAAe,IACpB,IAAM,EAAK,MAAM,GACjB,OAAM,EAAG,UAAU,CAAC,aAAa,WAAW,CAAC,CAAE,UAAW,CAAC,CAAE,GAC7D,MAAM,EAAG,UAAU,CAAC,UAAU,WAAW,CAAC,CAAE,MAAO,CAAE,GACrD,MAAM,EAAG,UAAU,CAAC,QAAQ,WAAW,CAAC,CAAE,MAAO,CAAE,GACnD,MAAM,EAAG,UAAU,CAAC,YAAY,WAAW,CAAC,CAAE,MAAO,CAAE,EACzD"}